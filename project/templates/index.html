{% extends "layout.html" %}

{% block title %}
    Index
{% endblock %}

{% block main %}
<!-- <script type="text/javascript">
    $(document).ready(function() {
      $('#form1').on('submit',function(e){
        $.ajax({
          data : {
            keyword : $('#keyword').val(),
          },
          type : 'POST',
          url : '/'
        })
        .done(function(data){
          document.getElementById('output').innerHTML = data;
        });
        e.preventDefault();
      });
    });
</script> -->

<script type="text/javascript">
  function saveArticle(keyword, title, source_name, author, url, publishedAt) {
    let request = new XMLHttpRequest();
    request.onreadystatechange = function(response) {
        if (request.readyState == 4 && request.status == 200){
          const message = JSON.parse(request.response);
          const show_message = document.getElementById('message');
          show_message.classList.add("show");
            console.log(show_message)
          setTimeout(() => {
            show_message.classList.remove("show");
          }, 5000)

        }
    };
    const data = {
      article: {
        keyword: keyword,
        title: title,
        source_name: source_name,
        author: author,
        url: url,
        publishedAt: publishedAt
      }
    }
    request.open("POST", "/save-article", true);
    request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    request.send(JSON.stringify(data));
  }
</script>

    <!-- <div class="message mb-3" id="message"></div> -->
    <div role="alert" aria-live="assertive" aria-atomic="true" id="message" class="toast position-fixed z-1" data-bs-autohide="false">
      <div class="toast-header">
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        Hello, world! This is a toast message.
      </div>
    </div>

    <form action="/" method="POST" id="form">

        <div class="form-check form-check-inline mb-3">
            <input class="form-check-input" checked type="radio" name="article_type" id="everything" value="everything">
            <label class="form-check-label" for="everything">News articles</label>
          </div>
          <div class="form-check form-check-inline mb-3">
            <input class="form-check-input" type="radio" name="article_type" id="top-headlines" value="top-headlines">
            <label class="form-check-label" for="top-headlines">Breaking news</label>
          </div>

        <div class="mb-3">
            <input class="form-control mx-auto w-auto" id="keyword" name="keyword" placeholder="Keyword or phrase" type="text">
        </div>

        <select class="form-select w-25 mx-auto mb-3" name="language" aria-label="Default select example">
            <option selected value="en">English</option>
            <option value="de">German</option>
            <option value="fr">French</option>
          </select>

        <button class="btn border mb-3" type="submit">Submit</button>

    </form>

    <div class="d-flex justify-content-center mb-3">
        Results for keyword: <span class="keyword ms-2">{{ keyword }}</span>
    </div>

    <div class="d-flex flex-wrap justify-content-around">

        {% for row in data %}

            <div class="card mx-3 my-4" style="width: 18rem;">
                <div class="card-header">{{ row['title'] }}</div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">{{ row['source.name'] }} {{ row['author'] }}</li>
                    <li class="list-group-item"><a href="{{ row['url'] }}"  target="_blank">{{ row['url'] }}</a></li>
                    <li class="list-group-item"><img src="{{ row['urlToImage'] }}" alt="" width="220" height="220"></li>
                    <li class="list-group-item">{{ row['publishedAt'] }}</li>
                </ul>

                {% if isLoggedIn %}
                  <button type="button" onclick="saveArticle( '{{ keyword }}', '{{ row['title'] }}', '{{ row['source.name'] }}', '{{ row['author'] }}', '{{ row['url'] }}', '{{ row['publishedAt'] }}' )" class="btn btn-primary mt-auto">Save to my articles</button>
                {% else %}
                  <a href="/login" class="btn btn-primary button mt-auto">Save to my articles</a>
                {% endif %}

            </div>

        {% endfor %}

    </div>


{% endblock %}


