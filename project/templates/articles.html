{% extends "layout.html" %}

{% block title %}
Articles
{% endblock %}

{% block main %}

<script type="text/javascript">
    function deleteArticleRow(id) {
      let request = new XMLHttpRequest();
      request.onreadystatechange = function(response) {
          if (request.readyState == 4 && request.status == 200){
            const search_history_id = JSON.parse(request.response);
            const show_message = document.getElementById('message');
            show_message.classList.add("show");
            setTimeout(() => {
              show_message.classList.remove("show");
              location.reload();
            }, 5000)
      };
    }
      const search_article_id = {
          id: id
      }
      request.open("POST", "/history", true);
      request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
      request.send(JSON.stringify(search_article_id));
    }
</script>

<h2 class="mb-5">Your saved articles</h2>

<table class="table">
    <thead>
        <tr>
            <th>NN</th>
            <th>Keyword</th>
            <th>Source</th>
            <th>Author</th>
            <th>Title</th>
            <th>URL</th>
            <th>Published</th>
        </tr>
    </thead>
    <tbody>
        {% for row in data %}
        <tr class="">
            <td>{{ row['nn'] }}</td>
            <td>{{ row['keyword'] }}</td>
            <td>{{ row['source'] }}</td>
            <td>{{ row['author'] }}</td>
            <td>{{ row['title'] }}</td>
            <td><a href="{{ row['url'] }}"  target="_blank">{{ row['url'] }}</a></td>
            <td>{{ row['published'] }}</td>
            <td>
                <button type="button" class="btn btn-primary" onclick="deleteSearchRow('{{ row['id'] }}')">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}